"0","df <- data %>% filter(sector%in%c(101,200)) %>% "
"0","  filter(year!=1996) %>% "
"0","  group_by(atc_code, year, sector) %>% "
"0","  summarize(cost = sum(cost_adj, na.rm=T)) %>% "
"0","  group_by(atc_code, sector) %>% "
"0","  mutate(atc_year=min(year)) %>% "
"0","  left_join(atc_codes, by=""atc_code"") %>% "
"0","  group_by(year, atc_year, atc_code, name, sector) %>% "
"0","  summarize(cost=sum(cost, na.rm=T)) %>% "
"0","  ungroup() %>% "
"0","  mutate(atc_year = case_when(    atc_year< 1998       ~ ""Before 1998"","
"0","                          between(atc_year, 1998,2000) ~ ""1998-2000"","
"0","                          between(atc_year, 2001,2003) ~ ""2001-2003"","
"0","                          between(atc_year, 2004,2006) ~ ""2004-2006"","
"0","                          between(atc_year, 2007,2009) ~ ""2007-2009"","
"0","                          between(atc_year, 2010,2012) ~ ""2010-2012"","
"0","                          between(atc_year, 2013,2015) ~ ""2013-2015"","
"0","                          between(atc_year, 2016,2019) ~ ""2016-2019"")) %>% "
"0","  mutate(atc_year = fct_relevel(atc_year, ""Before 1998"")) %>% "
"0","  mutate(sector=if_else(sector==101,""Prescription medication"",""Hospital medication""))"
"0",""
"0","dfs <- df %>% group_by(year, atc_year, sector) %>% summarize(cc=sum(cost))"
"0",""
"0","p.data <- merge(dfs,expand.grid(atc_year=unique(dfs$atc_year),"
"0","                            year=unique(dfs$year),"
"0","                            sector=unique(dfs$sector),"
"0","                            stringsAsFactors=F),all.y=T)"
"0",""
"0","pb <- colorRampPalette(brewer.pal(9, ""Blues""))"
"0","p.data$cc[is.na(p.data$cc)] <- 0"
"0",""
"0","me8 <- p.data %>%"
"0","  ggplot(aes(year, cc/1e3, fill=atc_year, group=atc_year)) + "
"0","  scale_fill_manual(values = pb(10)[2:24]) +"
"0","  scale_x_continuous(breaks=seq(1997,2019,2)) +"
"0","  scale_y_continuous(breaks=seq(0,13000,1000),label = unit_format(unit = ""m"", sep = """", accuracy = 1))+"
"0","  geom_area(color=""white"", size=0.1) + th1 + "
"0","  facet_wrap(~sector)+"
"0","  labs(y=""Expenditure"", x=NULL, fill=""Year introduced"") + theme(legend.position = ""right"")"
"0",""
"0","me8"
