"0",""
"0","th4 <- th3 + theme(title = element_text(size=7))"
"0",""
"0","tmp <- raw_pharm %>% "
"0","  filter(atc_code != ""fee_injmix"") %>% "
"0","  mutate(atc_group = substr(atc_code,1,3)) %>% "
"0","  group_by(atc_group) %>% "
"0","  summarize(cost=sum(cost)) %>% "
"0","  mutate(cate = case_when(atc_group == ""L01""~""Antineoplastic agents L01"","
"0","                          atc_group == ""L02""~""Endocrine therapy L02"","
"0","                          atc_group == ""L03""~""Immunostimulants L03"","
"0","                          atc_group == ""fee""~""Pharmacy mixing fee"","
"0","                          atc_group == ""M05""~""Drugs for treatment of bone diseases M05"","
"0","                          atc_group == ""B01""~""Antithrombotic agents B01"","
"0","                          atc_group == ""A04""~""Antiemetics and antinauseants A04"","
"0","                          atc_group == ""V03""~""Other therapeutic products V03"","
"0","                          TRUE ~ ""Others"")) %>% "
"0","  group_by(cate) %>% "
"0","  summarize(cost=sum(cost)/1e6/7.44) %>% "
"0","  ungroup() %>% "
"0","  mutate(pct=cost/sum(cost)*100) %>% "
"0","  mutate(cate=fct_reorder(cate, cost),"
"0","         cate=fct_relevel(cate, ""Others""))"
"0",""
"0","p1 <- tmp %>% ggplot(aes(cost, cate)) + geom_col(fill=pala) + th4 +"
"0","    geom_text(aes(label=paste0(round(pct,1),""%""), x=cost+3),hjust=0)+ "
"0","  scale_x_continuous(limits=c(0,170),labels=label_number(prefix = ""\u20AC"",accuracy = 1))+ "
"0","  labs(title=""Cost of 7 most expensive ATC level-3 groups\nFrom actual department billings in APOvision"", y=NULL,x=""Cost (millions)"")"
"0",""
"0","p2 <- raw_pharm %>% "
"0","  filter(atc_code != ""fee_injmix"") %>% "
"0","  group_by(gg=atc_code %in% sel) %>% "
"0","  summarize(cost=sum(cost)) %>% "
"0","  ungroup() %>% "
"0","  mutate(pct=cost/sum(cost)*100)%>% "
"0","    filter(gg) %>% "
"0","  ggplot(aes("" "",pct)) + geom_col(show.legend = F, fill=pala)+ th4+"
"0","    scale_y_continuous(limits=c(0,100)) +"
"0","  geom_text(aes(label=paste0(round(pct,1),""%""), y=pct+6))+ "
"0","  labs(title=""40 Selected % of\ntotal drug cost"", y=NULL,x=NULL)"
"0",""
"0","p3 <- raw_pharm %>% "
"0","  filter(substr(atc_code,1,1)==""L"") %>% "
"0","  group_by(gg=atc_code %in% sel) %>% summarize(cost=sum(cost)) %>% "
"0","  ungroup() %>% "
"0","  mutate(pct=cost/sum(cost)*100) %>% "
"0","  filter(gg) %>% "
"0","  ggplot(aes("" "",pct)) + geom_col(show.legend = F, fill=pala)+ th4+"
"0","  scale_y_continuous(limits=c(0,100)) +"
"0","  geom_text(aes(label=paste0(round(pct,1),""%""), y=pct+6))+"
"0","   labs(title=""40 Selected % of\nATC L-group cost"", y=NULL,x=NULL)"
"0",""
"0","#p1 + p3 + p2 + plot_layout(width=c(1,0.3,0.3))"
"0",""
"0","p4 <- ms %>% "
"0","  mutate(atc_group = substr(atc_code,1,3)) %>% "
"0","  group_by(atc_group) %>% "
"0","  summarize(n=n())  %>% "
"0","  mutate(cate = case_when(atc_group == ""L01""~""Antineoplastic agents L01"","
"0","                          atc_group == ""L02""~""Endocrine therapy L02"","
"0","                          atc_group == ""L03""~""Immunostimulants L03"","
"0","                          atc_group == ""fee""~""Pharmacy mixing fee"","
"0","                          atc_group == ""M05""~""Drugs for treatment of bone diseases M05"","
"0","                          atc_group == ""B01""~""Antithrombotic agents B01"","
"0","                          atc_group == ""A04""~""Antiemetics and antinauseants A04"","
"0","                          atc_group == ""V03""~""Other therapeutic products V03"","
"0","                          TRUE ~ ""Others"")) %>%  "
"0","  group_by(cate) %>% "
"0","  summarize(n=sum(n)/1e3) %>%"
"0","  ungroup() %>% "
"0","  mutate(pct=n/sum(n)*100) %>% "
"0","  mutate(cate=fct_relevel(cate, levels(tmp$cate))) %>% "
"0","  ggplot(aes(n, cate)) + geom_col(fill=pala) + th4 +"
"0","  geom_text(aes(label=paste0(format(round(pct,1),nsmall=1),""%""), x=n+3),hjust=0)+ "
"0","  scale_x_continuous(limits=c(0,330),labels=label_number(accuracy = 1))+ "
"0","  labs(title=""Number of treatments of 7 most expensive ATC level-3 groups\nFrom MedOnc registrations"", y=NULL,x=""Treatments (thousands)"")"
"0",""
"0","p5 <- ms %>% "
"0","  group_by(gg=atc_code %in% sel) %>% "
"0","  summarize(n = n()) %>% "
"0","  ungroup() %>% "
"0","  mutate(pct=n/sum(n)*100)%>% "
"0","  filter(gg) %>% "
"0","  ggplot(aes("" "",pct)) + geom_col(show.legend = F, fill=pala)+ th4+"
"0","  scale_y_continuous(limits=c(0,100)) +"
"0","  geom_text(aes(label=paste0(round(pct,1),""%""), y=pct+6))+ "
"0","  labs(title=""40 Selected % of\ntotal treatments"", y=NULL,x=NULL)"
"0",""
"0","p6 <- ms %>% "
"0","  filter(substr(atc_code,1,1)==""L"") %>% "
"0","  group_by(gg=atc_code %in% sel) %>%"
"0","  summarize(n = n()) %>% "
"0","  ungroup() %>% "
"0","  mutate(pct=n/sum(n)*100) %>% "
"0","  filter(gg) %>% "
"0","  ggplot(aes("" "",pct)) + geom_col(show.legend = F, fill=pala)+ th4+"
"0","  scale_y_continuous(limits=c(0,100)) +"
"0","  geom_text(aes(label=paste0(round(pct,1),""%""), y=pct+6))+"
"0","  labs(title=""40 Selected % of\nATC L-group treatments"", y=NULL,x=NULL)"
"0",""
"0","p1 + p3 + p2 + p4 + p6 + p5 + plot_layout(width=c(1,0.3,0.3),design = ""ABC\nDEF"")"
"0",""
