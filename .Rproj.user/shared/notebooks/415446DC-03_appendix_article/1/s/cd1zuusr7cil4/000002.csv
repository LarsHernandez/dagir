"0","tab <- mssg %>% "
"0","  bind_rows(mssg %>% mutate(grp=""Total"")) %>% "
"0","  group_by(grp) %>% "
"0","  arrange(grp,desc(med_price)) %>% "
"0","  mutate(pct = cumsum(med_price)/sum(med_price),"
"0","         nn = round(row_number()/n(),6)) %>% "
"0","  mutate(pct = case_when(abs(nn-0.01)  == min(abs(nn-0.01))  ~ round(pct,3)*100,"
"0","                         abs(nn-0.025) == min(abs(nn-0.025)) ~ round(pct,3)*100,"
"0","                         abs(nn-0.05)  == min(abs(nn-0.05))  ~ round(pct,3)*100,"
"0","                         abs(nn-0.50)  == min(abs(nn-0.50))  ~ round(pct,3)*100)) %>% "
"0","  filter(!is.na(pct)) %>% "
"0","    mutate(nn=round(nn*100)) %>% "
"0","  mutate(nn=if_else(nn%in% c(2,3),2.5,nn)) %>% "
"0","  select(pct, nn, grp) %>% "
"0","  mutate(pct = paste0(pct,""%"")) %>% group_by(nn, grp) %>% summarize(pct=first(pct)) %>% "
"0","  spread(key = nn, value = pct) %>% "
"0","  rename(""Diagnose"" = ""grp"","
"0","         ""Top 1%""   = ""1"","
"0","         ""Top 2.5%"" = ""2.5"","
"0","         ""Top 5%""   = ""5"","
"0","         ""Median""   = ""50"") %>% "
"0","  arrange(match(Diagnose, ""Total""), desc(.$""Top 1%""))"
"0",""
"0","ta1 <- tab %>% "
"0","  pivot_longer(-Diagnose) %>% "
"0","  pivot_wider(names_from = Diagnose, values_from = value) %>% "
"0","  kable(align = c(""l"", rep('r', 99))) %>%"
"0","  kable_styling(bootstrap_options = c(""hover"", ""condensed"", ""bordered""), font_size = 11, full_width = F) %>% "
"0","  add_header_above(c("" "" = 1, ""Percentage of expenditures"" = 11))"
"0",""
"0","ta1"
